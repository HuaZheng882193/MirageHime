# 文件名：.github/workflows/deploy.yml

name: Build and Deploy to GitHub Pages # workflow 的名称，会在 GitHub Actions 页面显示

on: # 触发条件：什么时候运行这个 workflow
  push: # 当推送代码时触发
    branches: [main] # 只在 push 到 main 分支时触发
  workflow_dispatch: # 允许在 GitHub 页面手动触发

jobs: # 定义任务（jobs）
  build-and-deploy: # job 的名称，可以自定义
    runs-on: ubuntu-latest # 运行环境：最新的 Ubuntu 虚拟机

    steps: # job 中的步骤（steps），按顺序执行
      - name: Checkout 代码 # 步骤名称（可选，但推荐写，便于查看日志）
        uses: actions/checkout@v4 # 使用官方的 checkout action，拉取仓库代码

      - name: 设置 Node.js
        uses: actions/setup-node@v4
        with: # action 的参数
          node-version: "20" # 使用 Node.js 20 版本（根据你的项目调整）
          cache: "npm" # 缓存 npm 依赖，加快后续运行

      - name: 安装依赖
        run: npm ci # 执行 shell 命令：干净安装依赖（推荐用 npm ci 而不是 npm install）

      - name: 构建项目
        run: npm run build # 执行构建命令（Create React App 输出到 build 文件夹）

      - name: 部署到 GitHub Pages
        uses: peaceiris/actions-gh-pages@v3 # 使用第三方 action 部署
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }} # 使用 GitHub 自动提供的 token（无需手动设置）
          publish_dir: ./build # 要部署的文件夹（Vite 项目改为 ./dist）
